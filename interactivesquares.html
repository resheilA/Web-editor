
<html>

<script>
  var rectid = 0;
  var rectx = 100;
  var lastMoveX=0, lastMoveY=0,dontmove = 0, changesize = 0;
 	
  function changeDimensions() {
        document.getElementById("rect1").setAttribute("x", "100");
    }	
	
  function drawRectangle() {
  var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg"); 
  var svgNS = svg.namespaceURI;
  var rect = document.createElementNS(svgNS,'rect');
    rect.setAttribute('x',10);
    rect.setAttribute('y',10);
	rect.setAttribute('oldx',10);
    rect.setAttribute('oldy',10);
    rect.setAttribute('width',250);
    rect.setAttribute('height',250);
    rect.setAttribute('fill','#95B3D7');
	rect.setAttribute('id', rectid);
	rect.setAttribute('onmousedown', 'moverect(event)');
	rect.setAttribute('transform', 'translate(00,00)');
    svg.appendChild(rect);
    document.getElementById("svgcanvas").appendChild(svg);
	rectid++;
	//rectx = rectx + 50;
    }  

	var moveid;	var xmove =0 , ymove =0;var xdown, ydown;var oldx, oldy;
    function moverect(event){
    xdown = event.clientX;
    ydown = event.clientY;
	dontmove = 0;
	moveid =  event.currentTarget.id;  
	//console.log(document.getElementById(moveid).getAttribute("x"));
	console.log(xdown - parseInt(document.getElementById(moveid).getAttribute("width")) + " "+ document.getElementById(moveid).getAttribute("x"));
	if((xdown - parseInt(document.getElementById(moveid).getAttribute("width"))) < document.getElementById(moveid).getAttribute("x") < (xdown - parseInt(document.getElementById(moveid).getAttribute("width")) + 10) )
	{
	dontmove = 1;changesize = 1;
	}	 
	
	
    this.onmousemove = function(event) {
	if(dontmove == 0){
	oldx = document.getElementById(moveid).getAttribute("oldx");
    oldy = document.getElementById(moveid).getAttribute("oldy");	
	
    xmove =  parseInt(oldx) + event.clientX - xdown;
    ymove =  parseInt(oldy) + event.clientY - ydown;
	
	//console.log(xmove + " " + ymove);
	// document.getElementById(moveid).setAttributeNS(null, "transform", 'translate('+ xmove+ ',' + ymove + ')');
	document.getElementById(moveid).setAttribute("x", xmove);
	document.getElementById(moveid).setAttribute("y", ymove);
	}
	
	this.onmouseup = function(event) {
	document.getElementById(moveid).setAttribute("oldx", xmove);
	document.getElementById(moveid).setAttribute("oldy", ymove);
    // console.log(document.getElementById(moveid).getCTM().e);
	// document.getElementById(moveid).setAttribute("x", document.getElementById(moveid).getCTM().e );
	
	if(changesize == 1){
	var nwidth = event.clientX;
	var nheight = event.clientY;
	document.getElementById(moveid).setAttribute("width", nwidth);
	document.getElementById(moveid).setAttribute("height", nheight);
	}
	
    changesize = 0;
	dontmove = 1;
	};	
	};
 } 

function savefile(){
var content = "data=" + document.getElementById("svgcanvas").innerHTML;
console.log(content);
 
var http = new XMLHttpRequest();
var url = "savesvg.php";
http.open("POST", url, true);

//Send the proper header information along with the request
http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

http.onreadystatechange = function() {//Call a function when the state changes.
    if(http.readyState == 4 && http.status == 200) {
        alert(http.responseText);
    }
}
http.send(content);

}
</script>

<body id='body'>
<svg id="svgcanvas" xmlns="http://www.w3.org/2000/svg" version="1.1" baseProfile="full" style="height:90%;width:90%;border:1px solid black;">
    <rect id="rect1" x="10" y="10" width="50" height="80"
          style="stroke:#000000; fill:none;" />
</svg>

<button onclick="changeDimensions()">Change dimensions</button>
<button onclick="drawRectangle()">Draw Rectangle</button>
<button onclick="savefile()">Save the changes made</button>
</body>
</html>